<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HARMONIE Baltic Region</title>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; text-align: center; margin: 0; padding: 0; background: #f5f7fa; color: #333; line-height: 1.6; }
        h1 { color: #2c3e50; margin: 40px 0 20px; }
        h2 { color: #34495e; margin: 30px 0 15px; }
        img { max-width: 100%; height: auto; border: 1px solid #ddd; border-radius: 10px; box-shadow: 0 6px 12px rgba(0,0,0,0.1); margin: 25px 0; }
        .download-btn { display: inline-block; margin: 12px; padding: 12px 28px; background: #2980b9; color: white; text-decoration: none; font-weight: 600; border-radius: 6px; transition: background 0.3s ease; }
        .download-btn:hover { background: #3498db; }
        .section { margin: 50px 0; padding: 0 20px; }
        select, input[type=range] { padding: 12px 16px; font-size: 1.1em; margin: 20px; border-radius: 8px; background: white; border: 1px solid #ccc; box-shadow: 0 2px 6px rgba(0,0,0,0.05); }
        #frame-time { font-size: 1.2em; font-weight: bold; margin: 10px; }
        .footer { margin: 80px 0 40px; color: #7f8c8d; font-size: 0.95em; }
    </style>
</head>
<body>
    <h1>HARMONIE Forecast – Baltic Region</h1>
    <p>High-resolution HARMONIE-AROME forecasts for Estonia, Latvia, Lithuania, and Southern Finland</p>

    <h2>Select Parameter</h2>
    <select id="param-select">
        <option value="temperature">2m Temperature (°C)</option>
        <option value="dewpoint">2m Dew Point (°C)</option>
        <option value="pressure">MSLP (hPa)</option>
        <option value="cape">CAPE (J/kg)</option>
        <option value="windgust">Wind Gust (m/s)</option>
        <option value="precipitation">1h Precipitation (mm)</option>
    </select>

    <div class="section">
        <h2>Current Analysis</h2>
        <img id="analysis-map" src="temperature.png" alt="Analysis Map">
        <br>
        <a id="download-analysis" href="temperature.png" download="HARMONIE_temperature_baltic.png" class="download-btn">
            Download Analysis Map (PNG)
        </a>
    </div>

    <div class="section">
        <h2>Forecast (Slider)</h2>
        <img id="forecast-img" src="temperature_frame_000.png" alt="Forecast Frame">
        <br>
        <input type="range" id="frame-slider" min="0" max="29" value="0" style="width:80%;">
        <div id="frame-time">Valid: Loading...</div>
    </div>

    <div class="footer">
        <p>Data source: Finnish Meteorological Institute (FMI) open data</p>
        <p>© Harmonie Baltic Region</p>
    </div>

    <script>
        const paramSelect = document.getElementById('param-select');
        const analysisMap = document.getElementById('analysis-map');
        const downloadAnalysis = document.getElementById('download-analysis');
        const forecastImg = document.getElementById('forecast-img');
        const frameSlider = document.getElementById('frame-slider');
        const frameTime = document.getElementById('frame-time');

        const baseFiles = {
            'temperature': 'temperature',
            'dewpoint': 'dewpoint',
            'pressure': 'pressure',
            'cape': 'cape',
            'windgust': 'windgust',
            'precipitation': 'precipitation'
        };

        // Approximate times (adjust if your step changes)
        const startHour = 0;  // First frame is +0h
        const frames = 30;  // Adjust to your actual number
        const times = [];
        for (let i = 0; i < frames; i++) {
            let hour = startHour + i;
            if (i >= 16) hour += (i - 16) * 2;  // After +48h, every 3h → adjust if needed
            const date = new Date();
            date.setHours(date.getHours() + hour);
            times.push(date.toLocaleString('en-GB', { weekday: 'short', day: 'numeric', month: 'short', hour: '2-digit', minute: '2-digit' }) + ' EET');
        }

        function updateAll() {
            const param = paramSelect.value;
            const base = baseFiles[param];
            const ts = Date.now();

            analysisMap.src = `${base}.png?ts=${ts}`;
            downloadAnalysis.href = `${base}.png`;
            downloadAnalysis.download = `HARMONIE_${param}_baltic.png`;

            updateFrame();
        }

        function updateFrame() {
            const param = paramSelect.value;
            const base = baseFiles[param];
            const frame = frameSlider.value.padStart(3, '0');
            forecastImg.src = `${base}_frame_${frame}.png?ts=${Date.now()}`;
            frameTime.textContent = `Valid: ${times[frameSlider.value] || 'Loading...'}`;
        }

        paramSelect.addEventListener('change', updateAll);
        frameSlider.addEventListener('input', updateFrame);
        window.onload = updateAll;
    </script>
</body>
</html>
